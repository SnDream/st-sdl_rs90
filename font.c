#include <SDL/SDL.h>
#include "font.h"

// font from https://github.com/nesbox/TIC-80
static const unsigned char embedded_font[] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x40, 0x40, 0x00, 0x40, 0x00, 0x00, 0x00, 0xa0, 0xa0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xa0, 0xe0, 0xa0, 0xe0, 0xa0, 0x00, 0x00, 0x00, 0x40, 0x60, 0x40, 0xc0, 0x40, 0x00, 0x00, 0x00, 0xa0, 0x20, 0x40, 0x80, 0xa0, 0x00, 0x00, 0x00, 0x40, 0xa0, 0x50, 0xa0, 0x50, 0x00, 0x00, 0x00, 0x40, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x40, 0x40, 0x40, 0x20, 0x00, 0x00, 0x00, 0x80, 0x40, 0x40, 0x40, 0x80, 0x00, 0x00, 0x00, 0x00, 0xa0, 0x40, 0xa0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0xe0, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x80, 0x00, 0x00, 0x00, 0x00, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00, 0x20, 0x40, 0x80, 0x00, 0x00, 0x00, 0x00, 0xe0, 0xa0, 0xa0, 0xa0, 0xe0, 0x00, 0x00, 0x00, 0x40, 0xc0, 0x40, 0x40, 0xe0, 0x00, 0x00, 0x00, 0xe0, 0x20, 0xe0, 0x80, 0xe0, 0x00, 0x00, 0x00, 0xe0, 0x20, 0xe0, 0x20, 0xe0, 0x00, 0x00, 0x00, 0xa0, 0xa0, 0xe0, 0x20, 0x20, 0x00, 0x00, 0x00, 0xe0, 0x80, 0xe0, 0x20, 0xe0, 0x00, 0x00, 0x00, 0xe0, 0x80, 0xe0, 0xa0, 0xe0, 0x00, 0x00, 0x00, 0xe0, 0x20, 0x20, 0x20, 0x20, 0x00, 0x00, 0x00, 0xe0, 0xa0, 0xe0, 0xa0, 0xe0, 0x00, 0x00, 0x00, 0xe0, 0xa0, 0xe0, 0x20, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x40, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x00, 0x40, 0x80, 0x00, 0x00, 0x00, 0x20, 0x40, 0x80, 0x40, 0x20, 0x00, 0x00, 0x00, 0x00, 0xe0, 0x00, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x80, 0x40, 0x20, 0x40, 0x80, 0x00, 0x00, 0x00, 0xc0, 0x20, 0x40, 0x00, 0x40, 0x00, 0x00, 0x00, 0x40, 0xa0, 0xa0, 0x80, 0x60, 0x00, 0x00, 0x00, 0x40, 0xa0, 0xa0, 0xe0, 0xa0, 0x00, 0x00, 0x00, 0xc0, 0xa0, 0xc0, 0xa0, 0xc0, 0x00, 0x00, 0x00, 0x40, 0xa0, 0x80, 0xa0, 0x40, 0x00, 0x00, 0x00, 0xc0, 0xa0, 0xa0, 0xa0, 0xc0, 0x00, 0x00, 0x00, 0xe0, 0x80, 0xc0, 0x80, 0xe0, 0x00, 0x00, 0x00, 0xe0, 0x80, 0xc0, 0x80, 0x80, 0x00, 0x00, 0x00, 0x60, 0x80, 0xa0, 0xa0, 0x60, 0x00, 0x00, 0x00, 0xa0, 0xa0, 0xe0, 0xa0, 0xa0, 0x00, 0x00, 0x00, 0xe0, 0x40, 0x40, 0x40, 0xe0, 0x00, 0x00, 0x00, 0x60, 0x20, 0x20, 0xa0, 0x40, 0x00, 0x00, 0x00, 0xa0, 0xa0, 0xc0, 0xa0, 0xa0, 0x00, 0x00, 0x00, 0x80, 0x80, 0x80, 0x80, 0xe0, 0x00, 0x00, 0x00, 0xa0, 0xe0, 0xe0, 0xa0, 0xa0, 0x00, 0x00, 0x00, 0xc0, 0xa0, 0xa0, 0xa0, 0xa0, 0x00, 0x00, 0x00, 0x40, 0xa0, 0xa0, 0xa0, 0x40, 0x00, 0x00, 0x00, 0xc0, 0xa0, 0xc0, 0x80, 0x80, 0x00, 0x00, 0x00, 0x40, 0xa0, 0xa0, 0xc0, 0x60, 0x00, 0x00, 0x00, 0xc0, 0xa0, 0xc0, 0xa0, 0xa0, 0x00, 0x00, 0x00, 0x60, 0x80, 0x40, 0x20, 0xc0, 0x00, 0x00, 0x00, 0xe0, 0x40, 0x40, 0x40, 0x40, 0x00, 0x00, 0x00, 0xa0, 0xa0, 0xa0, 0xa0, 0x60, 0x00, 0x00, 0x00, 0xa0, 0xa0, 0xa0, 0xa0, 0x40, 0x00, 0x00, 0x00, 0xa0, 0xa0, 0xe0, 0xe0, 0xa0, 0x00, 0x00, 0x00, 0xa0, 0xa0, 0x40, 0xa0, 0xa0, 0x00, 0x00, 0x00, 0xa0, 0xa0, 0x40, 0x40, 0x40, 0x00, 0x00, 0x00, 0xe0, 0x20, 0x40, 0x80, 0xe0, 0x00, 0x00, 0x00, 0x60, 0x40, 0x40, 0x40, 0x60, 0x00, 0x00, 0x00, 0x00, 0x80, 0x40, 0x20, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x40, 0x40, 0x40, 0xc0, 0x00, 0x00, 0x00, 0x40, 0xa0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xe0, 0x00, 0x00, 0x00, 0x80, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x20, 0x60, 0xa0, 0x60, 0x00, 0x00, 0x00, 0x80, 0x80, 0xc0, 0xa0, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x60, 0x80, 0x80, 0x60, 0x00, 0x00, 0x00, 0x20, 0x20, 0x60, 0xa0, 0x60, 0x00, 0x00, 0x00, 0x00, 0x40, 0xe0, 0x80, 0x60, 0x00, 0x00, 0x00, 0x20, 0x40, 0xe0, 0x40, 0x40, 0x00, 0x00, 0x00, 0x00, 0x40, 0xa0, 0x60, 0x20, 0xc0, 0x00, 0x00, 0x80, 0x80, 0xc0, 0xa0, 0xa0, 0x00, 0x00, 0x00, 0x40, 0x00, 0xc0, 0x40, 0xe0, 0x00, 0x00, 0x00, 0x20, 0x00, 0x20, 0x20, 0xa0, 0x40, 0x00, 0x00, 0x80, 0xa0, 0xc0, 0xa0, 0xa0, 0x00, 0x00, 0x00, 0x80, 0x80, 0x80, 0x80, 0x60, 0x00, 0x00, 0x00, 0x00, 0xa0, 0xe0, 0xa0, 0xa0, 0x00, 0x00, 0x00, 0x00, 0xc0, 0xa0, 0xa0, 0xa0, 0x00, 0x00, 0x00, 0x00, 0x40, 0xa0, 0xa0, 0x40, 0x00, 0x00, 0x00, 0x00, 0xc0, 0xa0, 0xc0, 0x80, 0x80, 0x00, 0x00, 0x00, 0x60, 0xa0, 0x60, 0x20, 0x20, 0x00, 0x00, 0x00, 0xc0, 0xa0, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00, 0x60, 0x80, 0x20, 0xc0, 0x00, 0x00, 0x00, 0x40, 0xe0, 0x40, 0x40, 0x20, 0x00, 0x00, 0x00, 0x00, 0xa0, 0xa0, 0xa0, 0x60, 0x00, 0x00, 0x00, 0x00, 0xa0, 0xa0, 0xa0, 0x40, 0x00, 0x00, 0x00, 0x00, 0xa0, 0xa0, 0xe0, 0xa0, 0x00, 0x00, 0x00, 0x00, 0xa0, 0x40, 0xa0, 0xa0, 0x00, 0x00, 0x00, 0x00, 0xa0, 0xa0, 0x60, 0x20, 0xc0, 0x00, 0x00, 0x00, 0xe0, 0x20, 0x40, 0xe0, 0x00, 0x00, 0x00, 0x60, 0x40, 0x80, 0x40, 0x60, 0x00, 0x00, 0x00, 0x40, 0x40, 0x40, 0x40, 0x40, 0x00, 0x00, 0x00, 0xc0, 0x40, 0x20, 0x40, 0xc0, 0x00, 0x00, 0x00, 0x60, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

void draw_char(SDL_Surface* surface, unsigned char symbol, int x, int y, unsigned short color) {
	// x += (4 - 1) * 1;
	int flip = 0;
	if(symbol > 127) { // flip symbols over 128
		flip = 1;
		symbol -= 128;
	}
	const unsigned char* ptr = embedded_font + symbol * 8;
	for (int ys = 0; (ys < 6) && (y + ys < surface->h); ptr++, ys++) {
		for (int xs = 0; (xs < 4) && (x + xs < surface->w); xs++) {
			if (*ptr & (1u << (8 - xs))) {
				((unsigned short*)surface->pixels)[(y + (flip ? 5 - ys : ys )) * (surface->w) + x + xs] = color;
			}
		}
	}
}

void draw_string(SDL_Surface* surface, const char* text, int orig_x, int orig_y, unsigned short color) {
	int x = orig_x, y = orig_y;
	while(*text) {
		if(*text == '\n') {
			x = orig_x;
			y += 6;
		} else {
			draw_char(surface, *text, x, y, color);
			x += 4;
		}
		text++;
	}
}
